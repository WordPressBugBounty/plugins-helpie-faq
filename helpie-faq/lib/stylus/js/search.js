import Tracker from"../../../assets/js/components/insights/tracker.js";import ObjectSearch from"../../../assets/js/components/faq/object_search.js";import FaqFunctions from"../../../assets/js/components/faq/functions.js";import FaqCollections from"../../../assets/js/components/faq/collections.js";import Pagination from"../../../assets/js/components/faq/pagination.js";import Mark from"mark.js";var selectors={accordions:".helpie-faq.accordions",faqSearch:".helpie-faq .search__wrapper .search__input",accordion:".accordion",accordionShow:"accordion--show",accordionHide:"accordion--hide",accordionHeading:".accordion__heading",accordionHeadingShow:"accordion__heading--show",accordionHeadingHide:"accordion__heading--hide",accordionHeader:".accordion .accordion__item .accordion__header",accordionItem:".accordion__item",accordionItemShow:"accordion__item--show",accordionItemHide:"accordion__item--hide",accordionBody:".accordion__body",searchMessage:".search .search__message",searchMessageContent:"<p class='search__message__content' role='status' aria-live='polite' aria-atomic='true'>"+faqStrings.noFaqsFound+"</p>"},Stylus={searchTerm:"",typingTimer:0,doneTypingInterval:2e3,paginationEnabled:"0",highlightEnabled:!!helpie_faq_object.enable_search_highlight&&helpie_faq_object.enable_search_highlight,normalizeText:function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()},setSearchAttr:function(){jQuery(selectors.accordionHeader).each((function(){var e=Stylus.normalizeText(jQuery(this).text());jQuery(this).attr("data-search-term",e)}))},showAllMatchedContent:function(e){1==this.highlightEnabled&&e.addClass("faq-search-matched")},resetShowingContent:function(){jQuery(".accordions .accordion__body").removeClass("faq-search-matched")},isContentMatch:function(e,o){var c=jQuery(e).find(selectors.accordionBody),t=Stylus.normalizeText(c.text());return this.showAllMatchedContent(c),t.indexOf(Stylus.normalizeText(o))>=0},resetHighlight:function(){new Mark(document.querySelector(".accordion"),{element:"span",className:"helpie-mark"}).unmark()},highlightText:function(e,o){if(0==this.highlightEnabled)return;let c={element:"span",className:"helpie-mark"};var t=new Mark(e);t.unmark({done:function(){t.mark(o,c)}})},isTitleMatch:function(e,o){var c=jQuery(e).find(".accordion__header").attr("data-search-term");return null!=c&&"undefined"!=c&&c.search(Stylus.normalizeText(o))>=0},isCategoryHeadingMatch:function(e,o){return Stylus.normalizeText(jQuery(e).prev(selectors.accordionHeading).text()).indexOf(Stylus.normalizeText(o))>=0},isCategroryAccordionMatch:function(e,o){if(0==jQuery(e).hasClass("accordion__category"))return!1;return this.isTitleMatch(e,o)},searchByAccordionItem:function(e,o){let c=this,t=c.searchTerm,r=c.isTitleMatch(e,t),s=c.isContentMatch(e,t),a=c.searchByTags(e,t);var n=!!(r||s||a);return c.displayAccordionItem(e,n),n},onSearchKeyup:function(e){var o=this;const c=Stylus.normalizeText(o.searchTerm);jQuery(e).closest(selectors.accordions).children(selectors.accordion).each((function(){var e=jQuery(this),t=!1,r=o.isCategoryHeadingMatch(e,c);let s=e.get(0);o.highlightText(s,c),1==r?(t=!0,o.showAccordionSection(e,t)):e.find(".helpie-faq-col").children("ul").children(selectors.accordionItem).each((function(){var e=jQuery(this),r=e.hasClass("accordion__category");let s=o.searchByCategory(e,c),a=!(!r||!s),n=0==a,i=!1;n&&(i=o.searchInnerAccordionsItems(e,c));let d=0==r,l=!1;d&&(l=o.searchByAccordionItem(e,{})),r&&0==i&&o.showCategoryWithAccordions(e,a),n&&i&&o.showAccordionBelongsToCategory(e,!0),0==t&&(1==a&&(t=!0),1==n&&1==i&&(t=!0),1==d&&1==l&&(t=!0))})),o.displayHeading(e,t),o.showAccordion(e,t)}))},searchByCategory:function(e,o){return this.isCategroryAccordionMatch(e,o)},searchInnerAccordionsItems:function(e,o){let c=this,t=!1;return e.find(selectors.accordionItem).each((function(){var e=jQuery(this);1==c.searchByAccordionItem(e,{})&&(t=!0)})),t},init:function(){var e=this;e.setSearchAttr(),jQuery(selectors.faqSearch).after('<div id="search-description" class="screen-reader-text">Search through FAQ items. Results will update as you type.</div>'),jQuery(selectors.faqSearch).on("focus",(function(){jQuery(this).closest(selectors.accordions).addClass("search-focused")})).on("blur",(function(){jQuery(this).closest(selectors.accordions).removeClass("search-focused")})),jQuery("body").on("keyup",selectors.faqSearch,(function(o){var c=jQuery(this).val().toLowerCase().replace(/[*+?^${}()|[\]\\]/gi,"");e.searchTerm=c;let t=FaqFunctions.getElements(this);e.paginationEnabled=FaqFunctions.paginationEnabled(this);var r=jQuery(selectors.accordionItem).is(":visible");return jQuery(this).attr("aria-expanded",r),e.canSeeEmptyFAQsBlock(this,"hide"),""==e.searchTerm&&"1"==e.paginationEnabled?(jQuery(t.root).attr("data-search","0"),e.showAllAccordionsFromObject(this),!1):""==e.searchTerm&&"1"!=e.paginationEnabled?(e.showAllAccordions(this),e.resetHighlight(this),e.resetShowingContent(this),!1):("1"==e.paginationEnabled?(jQuery(t.root).attr("data-search","1"),ObjectSearch.init(this,c)):e.onSearchKeyup(this),e.showEmptyFAQsContent(this),""!=e.searchTerm&&(clearTimeout(e.typingTimer),void(e.typingTimer=setTimeout((function(){Tracker.searchCounter(e.searchTerm)}),e.doneTypingInterval))))})),jQuery(selectors.accordionHeader).on("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),jQuery(this).trigger("click"))}))},showAllAccordions:function(e){var o=this;jQuery(e).closest(selectors.accordions).children(selectors.accordion).each((function(){let e=jQuery(this);o.showAccordion(e,true),o.displayHeading(e,true),e.find(selectors.accordion).removeClass(selectors.accordionHide).addClass(selectors.accordionShow),e.find(selectors.accordionItem).removeClass(selectors.accordionItemHide).addClass(selectors.accordionItemShow)}))},showEmptyFAQsContent:function(e){var o=this,c=0,t=jQuery(e).closest(selectors.accordions).find(selectors.accordionItem).length;jQuery(e).closest(selectors.accordions).find(selectors.accordionItem).each((function(){0==jQuery(this).is(":visible")&&(c=parseInt(c)+1)})),c==t&&(jQuery(e).closest(selectors.accordions).find(selectors.accordion).each((function(){let e=jQuery(this);o.displayHeading(e,!1),o.showAccordion(e,!1)})),jQuery(e).closest(selectors.accordions).find(selectors.searchMessage).empty().show().append(selectors.searchMessageContent).attr("role","status").attr("aria-live","polite").attr("aria-atomic","true"))},canSeeEmptyFAQsBlock:function(e,o){var c="none";"show"==o&&(c="block"),jQuery(e).closest(selectors.accordions).find(selectors.searchMessage).css("display",c)},displayAccordionItem:function(e,o){const c=1==o?selectors.accordionItemShow:selectors.accordionItemHide,t=0==o?selectors.accordionItemShow:selectors.accordionItemHide;e.removeClass(t).addClass(c)},displayHeading:function(e,o){const c=1==o?selectors.accordionHeadingShow:selectors.accordionHeadingHide,t=0==o?selectors.accordionHeadingShow:selectors.accordionHeadingHide;e.prev(selectors.accordionHeading).removeClass(t).addClass(c)},showCategoryAccordions:function(e,o){const c=1==o?selectors.accordionItemShow:selectors.accordionItemHide,t=0==o?selectors.accordionItemShow:selectors.accordionItemHide;jQuery(e).find(selectors.accordionItem).removeClass(t).addClass(c)},showAccordionSection:function(e,o){var c=this;c.displayHeading(e,o),c.showCategoryAccordions(e,o),c.showAccordion(e,o)},showAccordion:function(e,o){const c=1==o?selectors.accordionShow:selectors.accordionHide,t=0==o?selectors.accordionShow:selectors.accordionHide;jQuery(e).removeClass(t).addClass(c)},showCategoryWithAccordions:function(e,o){var c=this;c.displayAccordionItem(e,o),c.showCategoryAccordions(e,o),c.showAccordion(e,o)},showAccordionBelongsToCategory:function(e,o){jQuery(e).find(selectors.accordion).removeClass(selectors.accordionHide).addClass(selectors.accordionShow),this.displayAccordionItem(e,o)},searchByTags:function(e,o){let c=jQuery(e).find(".accordion__header").attr("data-tags"),t=!1;return null==c||"undefined"==c||0==c.length||c.split(",").forEach((function(e){-1!=(e=Stylus.normalizeText(e)).search(Stylus.normalizeText(o))&&(t=!0)})),t},showAllAccordionsFromObject:function(e){let o=FaqFunctions.getElements(e),c=FaqFunctions.getPaginationCurrentPage(o),t=FaqFunctions.getShortcodeIndex(o),r={page:c},s=FaqCollections.getCurrentShortcodeViewProps(t),a=FaqCollections.getTotalNoOfPages(s),n=FaqCollections.getCurrentPageViewProps(r,{collection:s.collection,items:s.items});FaqFunctions.appendFaqsContent(o,n),Pagination.renderPageLinks(o.pagination,{current:c,last:a})}};export default Stylus;